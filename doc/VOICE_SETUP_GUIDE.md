# 语音功能配置指南

## 概述

本项目集成了科大讯飞语音识别（ASR）和语音合成（TTS）服务，支持语音输入和语音反馈功能。

## 功能说明

语音功能是**可选功能**。如果不配置，语音按钮将被禁用，但不影响其他功能的使用。

### 语音功能包括：

1. **语音识别（ASR）**
   - 语音转文字输入
   - 实时语音命令识别
   - 支持中英文混合识别

2. **语音合成（TTS）**
   - 文字转语音播报
   - AI回复语音反馈
   - 多种音色选择

3. **语音命令**
   - 语音创建行程
   - 语音添加费用
   - 语音搜索景点

## 配置步骤

### 1. 申请科大讯飞API

1. 访问科大讯飞开放平台：https://www.xfyun.cn/
2. 注册并登录账号
3. 创建应用：
   - 进入"控制台" → "我的应用"
   - 点击"创建新应用"
   - 选择"WebAPI"类型
   - 填写应用名称和描述

4. 获取API密钥：
   - 在应用列表中找到刚创建的应用
   - 点击查看详情
   - 记录以下信息：
     - APPID
     - APIKey
     - APISecret

5. 开通服务：
   - 语音听写（流式版）WebAPI - 用于语音识别
   - 在线语音合成 WebAPI - 用于语音播报

### 2. 配置前端环境变量

在`frontend`目录下创建`.env`文件（或修改现有的）：

```bash
# 科大讯飞语音服务配置
VITE_XUNFEI_APP_ID=你的APPID
VITE_XUNFEI_API_KEY=你的APIKey
VITE_XUNFEI_API_SECRET=你的APISecret

# 启用语音功能
VITE_ENABLE_VOICE=true
```

### 3. 重启前端服务

```bash
cd frontend
npm run dev
```

## 禁用语音功能

如果不需要语音功能，可以在`.env`文件中设置：

```bash
VITE_ENABLE_VOICE=false
```

或者直接不设置科大讯飞相关的环境变量。语音按钮将自动禁用，不影响其他功能。

## 使用方式

### 方式一：按住说话

1. 按住语音按钮
2. 开始说话
3. 松开按钮，识别结果自动填入输入框

### 方式二：点击录音

1. 点击语音按钮开始录音
2. 说话
3. 再次点击停止录音

### 语音命令示例

**创建行程：**
> "我想去北京玩3天，预算5000元"

**搜索景点：**
> "搜索北京的景点"
> "查找附近的餐厅"

**添加费用：**
> "记录餐饮费用150元"
> "今天花了200块钱吃饭"

## 常见问题

### Q1: 语音按钮显示"语音服务未初始化"？

**解决方案：**
1. 检查`.env`文件是否正确配置
2. 确认`VITE_ENABLE_VOICE=true`
3. 确认科大讯飞API密钥配置完整
4. 重启前端服务

### Q2: 语音识别不准确？

**解决方案：**
1. 确保在安静的环境中使用
2. 说话清晰，语速适中
3. 使用标准普通话
4. 检查麦克风权限是否开启

### Q3: 没有语音权限？

**解决方案：**
1. 浏览器会弹出权限请求，点击"允许"
2. 如果已拒绝，在浏览器设置中重新开启麦克风权限
3. Chrome: 设置 → 隐私和安全 → 网站设置 → 麦克风
4. Firefox: 选项 → 隐私与安全 → 权限 → 麦克风

### Q4: HTTPS要求？

某些浏览器要求在HTTPS环境下才能使用麦克风。开发环境通常不受影响，但生产环境建议使用HTTPS。

## API配额

科大讯飞提供免费配额：

- **语音听写**：500次/天（免费版）
- **语音合成**：500次/天（免费版）

如需更多配额，请访问科大讯飞官网购买套餐。

## 技术细节

### 使用的SDK

- 语音识别：科大讯飞 IAT Web SDK
- 语音合成：科大讯飞 TTS Web SDK

### SDK加载

SDK通过CDN动态加载：
```
https://web-voice.iflytek.com/iat_web_sdk.js
https://web-voice.iflytek.com/tts_web_sdk.js
```

### 浏览器兼容性

- Chrome 60+
- Firefox 55+
- Safari 11+
- Edge 79+

## 安全建议

1. **不要将API密钥提交到代码仓库**
   - `.env`文件已加入`.gitignore`
   - 使用环境变量管理敏感信息

2. **使用环境隔离**
   - 开发环境和生产环境使用不同的API密钥
   - 定期轮换API密钥

3. **配额监控**
   - 在科大讯飞控制台监控API调用量
   - 设置用量告警

## 参考资料

- [科大讯飞开放平台](https://www.xfyun.cn/)
- [语音听写 WebAPI 文档](https://www.xfyun.cn/doc/asr/voicedictation/API.html)
- [在线语音合成 WebAPI 文档](https://www.xfyun.cn/doc/tts/online_tts/API.html)

## 支持

如有问题，请查看：
1. 科大讯飞官方文档
2. 项目README.md
3. 提交Issue到项目仓库

